@model IEnumerable<Cosmetics_Shopping_Website.GenericPattern.ViewModels.CartItemsVM>


@{
    Layout = "/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Cart";
}

<body class="mb-0">
    <div class="space bg-transparent"></div>
    <div class="d-flex align-items-center justify-content-center mt-5">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item text-black active"><a href='#' class="text-reset">Cart</a></li>
                <li class="breadcrumb-item text-black" aria-current="page">Shipping</li>
                <li class="breadcrumb-item text-black" aria-current="page">Payment</li>
                <li class="breadcrumb-item text-black" aria-current="page">Orders</li>
            </ol>
        </nav>
    </div>
    <div class="container-fluid mt-2 py-4 h-100">
        <div class="row d-flex justify-content-center align-items-center h-100">
            <div class="col-12">
                <div class="card rounded-3 shadow-lg">
                    <div class="card-body p-0">
                        <div class="row g-0">
                            @if (ViewData["cart"] != null)
                            {
                                <div class="col-12 cart_list">
                                    <div class="p-5">
                                        <div class="d-flex justify-content-between align-items-center mb-5">
                                            <h1 class="fw-bold mb-0 text-black">Shopping Cart</h1>
                                        </div>
                                        <hr class="my-4">
                                        <div class="mt-3">
                                            <div class="text-center p-3">
                                                <img src="~/images/empty-cart-removebg-preview.png" alt="empty-cart" >
                                                <h5 class="text-black">@ViewData["cart"]</h5>
                                                <a asp-controller="Users" asp-action="HomePage" class="btn btn-outline-dark w-50 mt-4">Continue Shopping</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                               

                            }
                            else
                            {
                                <div class="col-lg-8 cart_list">
                                    <div class="p-5">
                                        <div class="d-flex justify-content-between align-items-center mb-5">
                                            <h1 class="fw-bold mb-0 text-black">Shopping Cart</h1>
                                            <h6 class="mb-0 text-muted">@ViewData["CartItemsCount"] items</h6>
                                        </div>
                                        <hr class="my-4">



                                        @foreach (var item in Model)
                                        {
                                            <div class="row mb-4 d-flex justify-content-between align-items-center">
                                                <div class="col-md-2 col-lg-2 col-xl-2">
                                                    <img src="~/images/@item.VariantImage"
                                                         class="img-fluid rounded-3" alt="product">
                                                </div>
                                                <div class="col-md-3 col-lg-3 col-xl-3">
                                                    <h6 class="text-black mb-0">@item.VariantName</h6>
                                                </div>
                                                <div class="col-md-3 col-lg-3 col-xl-2 d-flex">
                                                    <button class="btn btn-link px-2 quantityChange"
                                                            onclick="this.parentNode.querySelector('input[type=number]').stepDown()" data-id="@item.Id">
                                                        <i class="fas fa-minus"></i>
                                                    </button>

                                                    <input min="0" name="quantity" value="@item.Quantity" type="number" data-id="@item.Id"
                                                           class="form-control form-control-sm quantityChange" data-toggle="tooltip" title="Select Quantity" style="width: 70px" />

                                                    <button class="btn btn-link px-2 quantityChange"
                                                            onclick="this.parentNode.querySelector('input[type=number]').stepUp()" data-id="@item.Id">
                                                        <i class="fas fa-plus"></i>
                                                    </button>
                                                </div>
                                                <div class="col-md-3 col-lg-2 col-xl-2 offset-lg-1">
                                                    <h6 class="mb-0">Rs. @item.CartItemPrice</h6>
                                                </div>
                                                <div class="col-md-1 col-lg-1 col-xl-1 text-end">
                                                    <a data-id="@item.Id" class="text-muted deleteCartItem"><i class="fas fa-times"></i></a>
                                                </div>
                                            </div>




                                        }

                                        <hr class="my-4">

                                        <div class="pt-5">
                                            <h6 class="mb-0">
                                                <a href='javascript:history.go(-1)' class="text-body">
                                                    <i class="fas fa-long-arrow-alt-left me-2"></i>Back to shop
                                                </a>
                                            </h6>
                                        </div>





                                    </div>
                                </div>
                                <div class="col-lg-4 cart_summary">
                                    <div class="p-5">
                                        <h3 class="fw-bold mb-5 mt-2 pt-1">Summary</h3>
                                        <hr class="my-4">

                                        <div class="d-flex justify-content-between mb-4">
                                            <h5 class="text-uppercase">Total items</h5>
                                            <h5>@ViewData["CartItemsCount"] </h5>
                                        </div>

                                       

                                        <div class="d-flex justify-content-between">
                                            <h5 class="text-uppercase">Total price</h5>
                                            <h5>Rs. @ViewData["TotalPrice"]</h5>
                                        </div>
                                        <hr class="my-4">
                                        <p>shipping charges calculated at checkout</p>

                                        <a asp-controller="Home" asp-action="SelectDeliveryAddress" type="button" class="btn btn-dark btn-block btn-lg w-100"
                                                data-mdb-ripple-color="dark">
                                            Proceed to Buy (@ViewData["CartItemsCount"] items)
                                        </a>

                                    </div>
                                </div>
                            }
                           
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="space bg-transparent"></div>
    @section scripts {
        <script>
            $(document).ready(function () {
                $('.deleteCartItem').click(function () {
                    var itemId = $(this).data('id');

                    $.ajax({
                        url: '@Url.Action("RemoveCartItem", "Home")',
                        data: { cartItemId: itemId },
                        success: function () {
                            location.reload();
                           
                           
                        },
                        error: function () {
                            Swal.fire({
                                icon: 'error',
                                title: 'Failure',
                                text: 'Error occurred while deleting the cart item.',
                                confirmButtonColor: '#28a745'
                            });
                            //alert('Error occurred while deleting the cart item.');
                        }
                    });
                });
            });
            $(".quantityChange").click(function () {
                var inputElement = $(this).parent().find('input[type=number]');
                var newValue = inputElement.val();
                var itemId = $(this).data('id');
                $.ajax({
                    url: '@Url.Action("CartItemQuantityChange", "Home")',
                    data: { cartItemId: itemId, quantity: newValue },
                    success: function () {
                        location.reload();
                    },
                    error: function () {
                        alert('Error occurred while changing the cart item.');
                    }
                });
            });
            $(".quantityChange").change(function () {
                var newValue = $(this).val();
                var itemId = $(this).data('id');
                $.ajax({
                    url: '@Url.Action("CartItemQuantityChange", "Home")',
                    data: { cartItemId: itemId, quantity: newValue },
                    success: function () {
                        location.reload();
                    },
                    error: function () {
                        alert('Error occurred while changing the cart item.');
                    }
                });
            });
        </script>
    }
   


</body>



